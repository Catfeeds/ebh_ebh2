<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>开通e板会服务</title>
<link type="text/css" rel="stylesheet" href="http://static.ebanhui.com/ebh/tpl/2012/css/base.css">
<link href="http://static.ebanhui.com/ebh/tpl/default/css/main.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://static.ebanhui.com/js/jquery-1.11.0.min.js"></script>
<!-- 引入xdialog弹出层控件开始 -->
<script type="text/javascript" src="http://static.ebanhui.com/ebh/js/xDialog/xloader.auto.js"></script>
<!-- 引入表单验证框架 -->
<script type="text/javascript" src="http://static.ebanhui.com/ebh/js/xform.js"></script>
<!-- 引入图片上传工具 -->
<script type="text/javascript" src="http://static.ebanhui.com/ebh/js/xPhoto.js"></script>
<style type="text/css">
html {
    background: #f3f3f3;
}
.topebroll {
    background: transparent url(http://static.ebanhui.com/ebh/tpl/2012/images/topgb511.jpg) repeat-x scroll center top;
    height: 150px;
    min-width: 960px;
    overflow: hidden;
    width: auto;
}
.toplogo {
    float: left;
    height: 53px;
    left: 0;
    margin-top: 22px;
    position: relative;
    width: 302px;
}
.main {
    background-color: #ffffff;
    border: 1px solid #cdcdcd;
    margin-left: auto;
    margin-right: auto;
    margin-top: -50px;
    padding: 20px 10px 80px;
    width: 970px;
	float:left;
}
.main .aed {
    background:url(http://static.ebanhui.com/ebh/tpl/2012/images/title001.gif) no-repeat scroll 0 0;
    color: #ffffff;
    float: left;
    font-size: 14px;
    font-weight: bold;
    height: 38px;
    width: 736px;
}
.main .aed p {
    padding-left: 12px;
    padding-top: 9px;
}
.footlintbg {
    margin-left: auto;
    margin-right: auto;
    width: 990px;
}
.lsitty {
	float:left;
	width:960px;
}
.tousts {
	font-size:18px;
	padding:15px 0 15px 20px;
}
.sead {
	color:#FF0000;
	font-weight:bold;
}
.dfassrt {
	font-size:24px;
	margin-left:50px;
}
.etwyht {
	font-size:16px;
	margin-top:15px;
	margin-left:50px;
}
.chste {
	font-weight:bold;
}
.lstbe {
	color:#1a8e09;
	font-weight:bold;
}
.rtygew {
	margin-left:50px;
	margin-top:20px;
	font-size:14px;
	line-height:1.8;
}
.reethen {
	border-top:solid 1px #ccc;
	margin:20px 50px 0;
	font-size:18px;
	height:50px;
	line-height:50px;
}
.retian {
	width:100%;
	float:left;
	margin-bottom:15px;
}
.kdbrty {
	width:165px;
	font-size:18px;
	font-weight:bold;
	color:#666;
	text-align:right;
	float:left;
	display:inline;
	padding-right:5px;
}
a.ryudfe {
	width:197px;
	height:101px;
	float:left;
}
.rekybi {
	color:#f51955;
	margin-left:15px;
	display:inline;
	font-weight:bold;
	float:left;
	margin-top:5px;
}
.ethge {
	float:left;
	height:26px;
	line-height:26px;
	border:solid 1px #dbdbdb;
	width:195px;
	font-size:14px;
	text-align:center;
	font-weight:bold;
}
.laist {
	float:left;
	height:26px;
	line-height:26px;
	border:solid 1px #dbdbdb;
	width:190px;
	font-size:14px;
	padding-left:5px;
}
.eltyrt {
	margin-left:75px;
    display: inline;
    float: left;
	margin-top:15px;
}
.lsitpe {
	float:left;
    font-size: 18px;
	font-weight:bold;
	color: #666;
	width:230px;
}
.gedtt {
	width:200px;
	float:left;
	font-size:14px;
	height:25px;
	margin-right:30px;
}
a.rystebr {
	background: #6489ac none repeat scroll 0 0;
    border-radius: 3px;
    color: #fff;
    display: inline-block;
    float: left;
	overflow: hidden;
    padding: 3px 20px;
	text-decoration:none;
	font-size:14px;
}

.retet {
	background:url(http://static.ebanhui.com/ebh/tpl/2012/images/anniu001.gif) no-repeat scroll 0 0;
    border-width: 0;
    color: #ffffff;
    font-size: 14px;
    height: 30px;
	line-height:30px;
    margin-left: 625px;
	display:inline;
	float:left;
    margin-top: 30px;
    width: 109px;
}
.datab {
    float: left;
    margin-left: 75px;
    margin-top: 15px;
	width:660px;
	border-collapse: collapse;
	border:solid 1px #000;
}
.datab th {
	background:#dff1ff;
	border:solid 1px #dbdbdb;
	padding: 10px 6px;
	font-size:14px;
	text-align: center;
}
.datab td {
	border:solid 1px #dbdbdb;
	padding: 10px 6px;
	text-align: center;
}
a.ketbtn {
	color:#666;
	text-decoration:underline;
}
.ejtyu {
	color:#6d6dbc;
	font-weight:bold;
}
.kstdg {
    cursor: pointer;
    display: inline;
    float: left;
    font-size: 14px;
    height: 30px;
    line-height: 30px;
    min-width: 120px;
    padding: 0 25px 0 6px;
    position: relative;
    z-index: 997;
}
.iptbox206 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll -67px -171px;
    border: medium none;
    float: left;
    height: 30px;
    width: 206px;
}
.iptbox206 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll -67px -171px;
    border: medium none;
    float: left;
    height: 30px;
    width: 206px;
}
.iptboxs206 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll -67px -206px;
    border: medium none;
    float: left;
    height: 30px;
    width: 206px;
}
.txtbox206 {
    background: none;
    border: medium none;
    font-size: 14px;
    height: 18px;
    line-height: 18px;
    padding: 6px;
    width: 194px;
}
.iptbox400 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll 0 -31px;
    border: medium none;
    float: left;
    height: 30px;
    width: 400px;
}
.iptboxs400 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll 0 -66px;
    border: medium none;
    float: left;
    height: 30px;
    width: 400px;
}
.txtbox400 {
    background: none;
    border: medium none;
    font-size: 14px;
    height: 18px;
    line-height: 18px;
    padding: 6px;
    width: 388px;
}
.kstdg200 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll -67px -381px;
    margin-right: 32px;
    min-width: 89px;
    width: 169px;
}
.kstdgs200 {
    background:url(http://static.ebanhui.com/ebh/tpl/2016/images/input.png) no-repeat scroll -67px -416px;
    margin-right: 32px;
    min-width: 89px;
    width: 169px;
}
.liawtlet a {
    color: #333;
    display: block;
    float: left;
    height: 30px;
    overflow: hidden;
    text-decoration: none;
    text-indent: 10px;
    width: 100%;
}
.liawtlet a:hover {
    background: #57a8e4 none repeat scroll 0 0;
}
.liawtlet {
    background: #fff none repeat scroll 0 0;
    border: 1px solid #57a8e4;
    left: 0;
    margin-bottom: 10px;
    position: absolute;
    top: 30px;
    width: 70px;
    z-index: 998;
}
.cuotic {
    background: url(http://static.ebanhui.com/ebh/tpl/2016/images/ebh_cohtk.jpg) no-repeat center left;
    padding-left: 20px;
    float: left;
    color: #f66175;
    height: 32px;
    line-height: 32px;
    margin-left: 10px;
}
.zhengtic {
	background:url(http://static.ebanhui.com/ebh/tpl/2016/images/ebh_queht.jpg) no-repeat center left;
	padding-left:20px;
	float:left;
	color:#78c81e;
	height:32px;
	line-height: 32px;
    margin-left: 10px;
}
.hit{
	color: #999;
}
.vholder{
	overflow:hidden;
	height:30px;
	display:block;
}
.tjcgts{ 
	color:#f00; 
	font-weight:bold;
	padding-left:75px;
	display:none;
	line-height:20px;
}
.ejtyu a{
	color: #6d6dbc;
    font-weight: bold;
}
</style>
<script language="javascript">
function check(obj){
    var data = _xform.getdata();
    var action = $(this).attr('maction');
	//过滤无用属性
    delete data.button;
    $.ajax({
        type: "POST",
        url: '/classactive/'+action+'.html',
        data:data,
        async:false,
        dataType: 'json',
        success: function(res) {
            obj.res = res.status;
            obj.msg = res.msg;
        }
    });
}
function call_carda_func(data){
    $("#billshow").attr({'src':data.fileinfo.showurl});
    $("#billfield").val(data.fileinfo.url).blur();
    H.get("card_uploader").exec('close');
}
function call_carda_uploader(){
        prepare_card_uploader(function(data){
            data = $.parseJSON(data);
            call_carda_func(data);
        });
    window.card_uploader.doShow();
}
//准备一个汇款单上传实例(用时调用)
function prepare_card_uploader(callback,initpicurl){
    var upurl = '<?=$upurl?>?type=pic&subtype=uthum';
    window.card_uploader = new xPhoto({
        id:'card_uploader',
        title:' ',
        callback:callback,
        initpicurl:initpicurl,
        upurl:encodeURIComponent(upurl),
        cancelcallback:function(){
            window.card_uploader.doClose();
        },
        sizearr:new Array('280_170'),
        sizemsgarr:new Array('')
    });
    window.card_uploader.renderDialog();
};
$(function(){
	//验证框架初始化
    window._xform = new xForm({
        domid:'checkform',
        showokmsg:true,
        errorcss:'cuotic',
        okcss:'zhengtic',
        focuscallback:function($dom){
            if($dom.is('input')){
                $dom.parent('div.iptbox206').removeClass('iptbox206').addClass('iptboxs206');
                $dom.parent('div.iptbox400').removeClass('iptbox400').addClass('iptboxs400');
            }
        },
        blurcallback:function($dom){
            if($dom.is('input')){
            	$dom.parent('div.iptboxs206').removeClass('iptboxs206').addClass('iptbox206');
                $dom.parent('div.iptboxs400').removeClass('iptboxs400').addClass('iptbox400');
            }
        }
	})
	//上传汇款单
	$('#billwrap').on('click',function(){
		 call_carda_uploader();
	})
	//下拉菜单事件绑定
	$(document).on('click','.kstdg',function(){
		var optid = $(this).attr('id');
		if(optid == 'firstopt'){
			$('#secondopt .liawtlet').hide();
			$('#thirdopt .liawtlet').hide();
		}else if(optid == 'secondopt'){
			$('#firstopt .liawtlet').hide();
			$('#thirdopt .liawtlet').hide();
		}else{
			$('#firstopt .liawtlet').hide();
			$('#secondopt .liawtlet').hide();
		}		
		$(this).find('.liawtlet').toggle();
		$(this).find('.liawtlet').is(':hidden') ? $(this).removeClass('kstdgs200') : $(this).addClass('kstdgs200');
		return false;
	})
	
	$(document).on('click','#firstopt .liawtlet a',function(){
		var tag = $(this).attr('tag'),
			tit = $(this).html(),
			cnode = $(this).parent().parent(),
			node = cnode.find('.vholder');
			if(node.attr('tag') != tag){
				node.attr('tag',tag);
				node.html(tit);
				var fcate = $('#firstopt .vholder').attr('tag'),
					scate = $('#secondopt .vholder').attr('tag'),
					tcate = $('#thirdopt .vholder').attr('tag');
	
				//渲染出第二级分类
				$.post('/classactive/getselpaypackage.html',{fcate:fcate,scate:scate,tcate:tcate,type:0},function(data){
					var htmlstr = '';
					if(data.length >0){
						for(var i in data){
							htmlstr += '<a class="chver_option" href="javascript:;" tag="'+data[i].sid+'" title="'+data[i].tit+'">'+data[i].tit+'</a>';
						}
					}
					$('#secondopt .liawtlet').html(htmlstr);		
				},'json');
				$('#thirdopt .liawtlet').html('');
				$('#secondopt .vholder').attr('tag',-1);
				$('#secondopt .vholder').html('请选择课程分类');
				$('#thirdopt .vholder').attr('tag',-1);
				$('#thirdopt .vholder').html('请选择课程');
				$('#secondopt .liawtlet').hide();
				$('#thirdopt .liawtlet').hide();
			}
			$('#firstopt').removeClass('kstdgs200');
			$(this).parent().hide();
			return false;
	})
	$(document).on('click','#secondopt .liawtlet a',function(){
		var tag = $(this).attr('tag'),
		tit = $(this).html(),
		cnode = $(this).parent().parent(),
		node = cnode.find('.vholder');
		if(node.attr('tag') != tag){
			node.attr('tag',tag);
			node.html(tit);
			var fcate = $('#firstopt .vholder').attr('tag'),
				scate = $('#secondopt .vholder').attr('tag'),
				tcate = $('#thirdopt .vholder').attr('tag');
			//渲染出第三级分类
			$.post('/classactive/getselpaypackage.html',{fcate:fcate,scate:scate,tcate:tcate,type:1},function(data){
				var htmlstr = '';
				if(data.length >0){
					for(var i in data){
						htmlstr += '<a class="chver_option" href="javascript:;" data="'+data[i].data+'" tag="'+data[i].itemid+'" title="'+data[i].iname+'">'+data[i].iname+'</a>';
					}
				}
				$('#thirdopt .liawtlet').html(htmlstr);		
			},'json');
		}
		$('#thirdopt .vholder').attr('tag',-1);
		$('#thirdopt .vholder').html('请选择课程');
		$('#secondopt .liawtlet').hide();
		$('#thirdopt .liawtlet').hide();
		$('#secondopt').removeClass('kstdgs200');
		$(this).parent().hide();
		return false;
	})
	$(document).on('click', '#thirdopt .liawtlet a',function(){
		var tag = $(this).attr('tag'),
		tit = $(this).html(),
		cnode = $(this).parent().parent(),
		node = cnode.find('.vholder');
		if(node.attr('tag') != tag){
			node.attr('tag',tag);
			node.html(tit);
		}
		$('#thirdopt').removeClass('kstdgs200');
		$(this).parent().hide();
		return false;
	})
	$(document).on('click', function(e) {
        var target = e.srcElement || e.target;
        if(!($(target).is('.kstdg') || $(target).is('.vholder'))){
			$('.liawtlet').hide();
        }
    })
    //添加课程服务
    $('#rystebr').on('click',function(){
		var sel = $('#thirdopt .vholder').attr('tag');
		if(parseInt(sel) <=0 ){
			alert('请选择课程!');
			return false;
		}
		var node = $('#thirdopt .liawtlet .chver_option[tag='+sel+']'),
			row = node.attr('data'),
			rowarr = row.split('###');	
        var htmlstr = '';
        	htmlstr += '<tr itemid="'+rowarr[0]+'" fee="'+rowarr[3]+'">';
        	htmlstr += '<td style="text-align:left;"><span class="ejtyu"><a href="/courseinfo/'+rowarr[0]+'.html" target="_blank">'+rowarr[1]+'</a></span></td>';
        	htmlstr += '<td><span class="lstbe">'+rowarr[2]+'</span></td>';
        	htmlstr += '<td><span class="lstbe">￥'+rowarr[3]+'元</span></td>';
        	htmlstr += '<td><a href="javascript:;" class="ketbtn">取消</a></td></tr>';
		if($('.datab tr[itemid='+sel+']').length == 0){	
        	$('.datab tr:last').after(htmlstr);
        	var totalfee = parseFloat($('#totalfee').val()) + parseFloat(rowarr[3]);
			var product = $('#productstr').val();
			var tmpstr = product == '' ? sel : product+','+sel;
			$('#productstr').val(tmpstr);	
        	$('#totalfee').val(totalfee);
        	$('#productstr').blur();
		}else{
			$('.tjcgts').show();
			$('.datab tr[itemid='+sel+']').css({background:'#F3F9FC'});
			setTimeout(function(){$('.datab tr[itemid='+sel+']').removeAttr('style');},3000)
			$('.tjcgts').fadeOut(3000);
		}
    })
    //延迟绑定取消
    $(document).on('click','.ketbtn',function(){
		var node = $(this).parent().parent(),
			itemid = node.attr('itemid'),
			fee = node.attr('fee'),
			totalfee = parseFloat($('#totalfee').val()) - parseFloat(fee);
		$('#totalfee').val(totalfee);
		node.remove();
		var product = $('#productstr').val(),
			tmparr = product.split(',');
		if(tmparr.length>0){
			for(var i=0;i<tmparr.length;i++){
				if(tmparr[i] == itemid){
					tmparr.splice(i, 1);
				}
			}
		}
		//重新赋值
		$('#productstr').val(tmparr.join(','));
		$('#productstr').blur();
    })
    //提交表单
	$("#activeBtn").unbind('click').bind('click',function(){
		submitbtn_click();
	});
    function submitbtn_click(){
    	$("#activeBtn").unbind('click');
    	$("#activeBtn").val('校验中...');
    	setTimeout(function(){
    		var check_ret = _xform.check();
    	    	if(!(check_ret)){
    	            $("#activeBtn").val('校验失败');
    	            setTimeout(function(){
    	                $("#activeBtn").val('再次提交').bind('click',function(){
    	                    submitbtn_click();
    	                });
    	            },1500);
    	            return;
    	        }
    	    	//提交数据
    	        $("#activeBtn").val('提交中...');
    	        var data = _xform.getdata();
    	        var url = "/classactive/doaddorder.html";
				var r = true;
				if(data.fee != data.totalfee){
					r = confirm('您填入的汇款金额与选择的课程服务总费用不相等，是否确认提交！')
				}
				if(r){
					$.ajax({
    	                url: url,
    	                type:"post",
    	                dataType:"json",
    	                data:data,
    	                async:false,
    	                success: function(res){
    	                    if(res.status == true){
    	                        $("#activeBtn").val('提交汇款表单');
    	                        location.href="/classactive/aosuccess.html";
    	                    }else{
        	                    if(res.code == -1){
            	                    location.href="<?=geturl('login').'?returnurl=/classactive/bank.html'?>"
                	                return;
            	                }
    	                        $("#activeBtn").val('再次提交').bind('click',function(){
    	                            submitbtn_click();
    	                        });
    	                    }
    	                }
    	        	});
				}else{
					$("#activeBtn").val('再次提交').bind('click',function(){
                        submitbtn_click();
                    });
				}
        },200)
    }
})
</script>
</head>

<body>
<div class="topebroll">
    <div style="width:960px; margin:0 auto; position:relative">
        <div class="toplogo">
            <a href="/">
            	<img src="http://static.ebanhui.com/ebh/tpl/2016/images/login511.jpg?v=1">
            </a>
        </div>
    </div>
</div>

<div style="height: auto; background:url(http://static.ebanhui.com/ebh/tpl/2012/images/bg12511.jpg) repeat scroll 0px 0px;">
    <div style="width:990px;margin:0 auto;">
        <div id="checkform" class="main">
            <div class="aed">
            	<p>欢迎开通【<?=$roominfo['crname']?>】服务</p>
            </div>
            <div class="lsitty">
            	<h2 class="tousts">亲爱的学员：<?=$user['username']?>(<?=$user['realname']?>)，您好！您可以转账到以下账号开通服务：</h2>
            	<div style="margin-left:50px"><?=$transferinfo?></div>
                <div class="reethen">如果汇款成功后请填写如下表格待客服进行审核</div>
                <div class="retian">
                	<span class="kdbrty">上传汇款底单：</span>
                    <a id="billwrap" href="javascript:;" class="ryudfe"><img id="billshow" width="197px" height="101px" src="http://static.ebanhui.com/ebh/tpl/2016/images/dfhd.jpg" /></a>
                    <span class="rekybi" style="margin-top:30px;">(*必填)</span><span style="margin-top:25px" id="billfield_msg"></span>
                    <input id="billfield" type="hidden" name="billfield"  x_func="check"  maction="check_billfield" />
                </div>
                <div class="retian">
                	<span class="kdbrty">汇款金额：</span>
                    <div class="iptbox206">
                        <input id="fee" class="txtbox206" type="text" maction="check_fee" x_func="check" name="fee" x_status="-1">
                    </div>
                    <span class="rekybi">(*必填)</span>
                    <span id="fee_msg"></span>                
                </div>
                <div class="retian">
                	<span class="kdbrty">联系方式：</span>
                    <div class="iptbox206">
                        <input id="contact" class="txtbox206" type="text" maction="check_contact" x_func="check" name="contact" x_status="-1">
                    </div>
                    <span class="rekybi">(*必填)</span> 
                    <span id="contact_msg"></span>             
                </div>
                <div class="retian">
                	<span class="kdbrty">其他说明：</span>
                    <div class="iptbox400">
                        <input id="remark" class="txtbox400" type="text" maction="check_remark" x_func="check" name="remark" x_status="-1">
                    </div>
                    <span id="remark_msg"></span>            
                </div>
				<div class="eltyrt">
                	<span class="lsitpe">服务包名称</span>
                    <span class="lsitpe">课程分类</span>
                    <span class="lsitpe">开通课程</span>
                </div>
				<div class="eltyrt">
                    <div id="firstopt" class="kstdg kstdg200 isselect" style=" z-index: 9;" opencss="kstdgs120">
                    	<span class="vholder" tag="0">请选择服务包</span>
                    	<div class="liawtlet" style="max-height: 600px;width:198px; overflow-y: auto; display:none;">
                    		<?php foreach ($package as $seritem){ ?>
                    			<a class="chver_option" href="javascript:;" tag="<?=$seritem['pid']?>" title="<?=$seritem['pname']?>"><?=$seritem['pname']?></a>
                    		<?php } ?>
                        </div>
                    </div>
                    <div id="secondopt" class="kstdg kstdg200 isselect" style=" z-index: 9;" opencss="kstdgs120">
                    	<span class="vholder" tag="-1">请选择课程分类</span>
                    	<div class="liawtlet" style="max-height: 600px;width:198px; overflow-y: auto; display:none; "></div>
                    </div>
                    <div id="thirdopt" class="kstdg kstdg200 isselect" style=" z-index: 9;" opencss="kstdgs120">
                    	<span class="vholder" tag="-1">请选择课程 </span>
                    	<div class="liawtlet" style="max-height: 600px;width:198px; overflow-y: auto; display:none; "></div>
                    </div>
                  <a href="javascript:;" id="rystebr" class="rystebr">添加</a>
				</div>
				<div style="clear: both;"></div>
				<div style="height:20px;"><div class="tjcgts">你已经添加过了，不用重复添加</div></div>
                <table class="datab" style=" margin-top:0;">
                    <tr>
                        <th width="50%">课程名称</th>
                        <th width="20%">有效期</th>
                        <th width="20%">服务费</th>
                        <th width="10%">操作</th>
                    </tr>
              	</table>
              	<span id="productstr_msg"></span>
              	<input id="productstr" name="productstr" type="hidden" value="" maction="check_product" x_func="check">
              	<input id="totalfee" name="totalfee" type="hidden" value="0.00">
              	<input id="activeBtn" class="retet" type="button" value="提交汇款表单" name="button" style="cursor: pointer;">
          </div>
        </div>
    </div>
</div>

<div class="footlintbg">
<img width="990" height="16" src="http://static.ebanhui.com/ebh/tpl/2012/images/doot5111.jpg">
</div>
<?php $this->display('common/site_footer'); ?>